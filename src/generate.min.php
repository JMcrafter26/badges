<?php $Version='1.3.1';$maintenace=false;$maintenacePassword='CH4NGEtheP4ssw0rd!';$icon='&#xf09b;';$label='Documentation:';$message='go.jm26.net/badge-docs';$labelColor='#555555';$messageColor='#97CA00';$colorText='#ffffff';$autoFontColor=true;$imageFormat='png';$cacheLife=5;$scale=15;$maxScale=100;$resizeOutput=false;$font='./DejaVuSans.woff';$icons='./font-awesome.woff';$defaultMessageIsSet=true;$color_random='#'.substr(md5(mt_rand()),0,6);$color_brightgreen='#44cc11';$color_green='#97CA00';$color_yellowgreen='#a4a61d';$color_yellow='#dfb317';$color_orange='#fe7d37';$color_red='#e05d44';$color_lightgrey='#9f9f9f';$color_cyan='#00eaff';$color_blue='#007ec6';$color_violet='#7b16ff';$color_pink='#ff69b4';$color_grey='#555555';$color_silver='#9f9f9f';$color_black='#000000';$color_white='#ffffff';$color_success='#44cc11';$color_ok='#97CA00';$color_important='#fe7d37';$color_critical='#e05d44';$color_informational='#007ec6';$color_inactive='#9f9f9f';$color_highlight='#dbe300';$connection='https';$checkForUpdates=true;$_GET=array_change_key_case($_GET,CASE_LOWER);if(isset($_GET['status'])&&!isset($_GET['message'])&&!isset($_GET['label'])){$status='ok';$badgeMessage=$message;$message='';$warnings=0;if($maintenace){$status='warning';$message.='Maintenance mode is enabled/';$warnings++;}if(!extension_loaded('gd')&&!function_exists('gd_info')){$status='error';$status_gd='false';$message.='PHP GD extension is not installed/';$warnings++;}else{$status_gd='true';}if(!file_exists($font)){$status='error';$status_font='false';$message.='DejaVuSans.woff is not downloaded/';$warnings++;}else{$status_font='true';}if(!file_exists($icons)){$status='error';$status_icons='false';$message.='font-awesome.woff is not downloaded/';$warnings++;}else{$status_icons='true';}if(!@fsockopen('www.google.com',80)){$status_internet='offline';$status='false';$message.='Not connected to the internet/';}else{$status_internet='true';}$server=$_SERVER['SERVER_SOFTWARE'];$server=explode('/',$server);$server=$server[0];$php=phpversion();if(!@fsockopen('api.jm26.net',80)){$status_update='false';$status='error';$message.='api.jm26.net/badge is offline/';$warnings++;}else{$status_update='true';}$github=get_headers($connection.'://raw.githubusercontent.com/JMcrafter26/php-badges/main/README.md');if($github[0]=='HTTP/1.1 404 Not Found'){$status_github='false';$status='error';$message.='Github repo not found/';$warnings++;}else{$status_github='true';}$newVersion=file_get_contents($connection.'://raw.githack.com/JMcrafter26/php-badges/main/stable-version.json');if($newVersion==''){$status='error';$message.='Could not get the latest version/';$warnings++;}$newVersion=json_decode($newVersion,true);$newVersion=$newVersion['Version']['Stable'];if($newVersion>$Version){$status='error';$message.='New version available/';$warnings++;$updateAvailable=true;}else{$updateAvailable=false;}if($checkForUpdates==false){$status='error';$message.='Update check disabled';$warnings++;}if($warnings==0){$message='Everything is working fine!';}$json=array("status"=>$status,"warnings"=>$warnings,"message"=>$message,"version"=>array("current version"=>$Version,"newest version"=>$newVersion,"update available"=>$updateAvailable,"check for updates"=>$checkForUpdates,"update url"=>"https://github.com/JMcrafter26/php-badges/releases/latest"),"server"=>array("server"=>$server,"php"=>$php,"directory"=>getcwd(),"file"=>__FILE__,"host"=>$_SERVER['SERVER_NAME'],"ip"=>$_SERVER['SERVER_ADDR'],"gd extension"=>$status_gd),"assets"=>array("font"=>$status_font,"icons"=>$status_icons),"external services"=>array("internet"=>$status_internet,"github repo"=>$status_github,"update server"=>$status_update),"configuration"=>array("maintenance mode"=>$maintenace,"icon"=>$icon,"label"=>$label,"message"=>$badgeMessage,"label color"=>$labelColor,"message color"=>$messageColor,"color text"=>$colorText,"auto font color"=>$autoFontColor,"image format"=>$imageFormat,"cachelife"=>$cacheLife,"scale"=>$scale,"resize output"=>$resizeOutput,"font path"=>$font,"icons path"=>$icons,));if($_GET['status']==$maintenacePassword){header('Content-Type: application/json');$json=json_encode($json,JSON_PRETTY_PRINT);echo $json;die();}else{$defaultMessageIsSet=false;$label='Status';$message=$json['status'];if($json['status']=='ok'){$color=$color_ok;}else{$color=$color_critical;}if($_GET['status']=='json'){header('Content-Type: application/json');$json=array("status"=>$status,"version"=>$Version,"gitHub"=>"https://github.com/JMcrafter26/php-badges/releases/latest");die(json_encode($json,JSON_PRETTY_PRINT));}}}if($maintenace==true&&$_GET['password']!=$maintenacePassword){header('Content-Type: image/png');readfile($connection.'://i.imgur.com/iR3RI3Q.png');header('HTTP/1.0 503 Service Unavailable');die();}if(!extension_loaded('gd')&&!function_exists('gd_info')){header('Content-Type: image/png');readfile($connection.'://i.imgur.com/S8dD7GE.png');header('HTTP/1.0 500 Internal Server Error');die();}if(!file_exists($font)){$fontDwnl=file_get_contents($connection.'://api.jm26.net/badge/DejaVuSans.woff');file_put_contents($font,$fontDwnl);if(!file_exists($font)){header('Content-Type: image/png');readfile($connection.'://i.imgur.com/QfttAR6.png');}}if(!file_exists($icons)){$iconsDwnl=file_get_contents($connection.'://api.jm26.net/badge/font-awesome.woff');file_put_contents($icons,$iconsDwnl);if(!file_exists($icons)){header('Content-Type: image/png');readfile($connection.'://i.imgur.com/QfttAR6.png');}}if(isset($_GET['url'])&&!empty($_GET['url'])){$url=$_GET['url'];$url=htmlspecialchars($url);if(substr($url,0,4)!='http'){if(substr($url,0,1)=='/'){$url=substr($url,1);}if(substr($url,-1)=='/'){$url=substr($url,0,-1);}if(substr($url,-5)=='.json'){$url=substr($url,0,-5);}$url=$connection.'://img.shields.io/'.$url.'.json';}if(filter_var($url,FILTER_VALIDATE_URL)===false){$label='Error';$message='Invalid URL';$messageColor='red';}else{$json=file_get_contents($url);$json=json_decode($json,true);$defaultMessageIsSet=false;if($json==null){$label='Error';$message='Invalid JSON';$messageColor='red';}else{if(array_key_exists('label',$json)or array_key_exists('message',$json)or array_key_exists('color',$json)or array_key_exists('value',$json)){$label=$json['label'];if(!isset($json['message'])and isset($json['value'])){$message=$json['value'];}else{$message=$json['message'];}if(isset($_GET['format'])&&$_GET['format']!=''){$jsonFormat=$_GET['format'];$jsonFormat=strtolower($jsonFormat);if($jsonFormat=='low'){$label=strtolower($label);$message=strtolower($message);}elseif($jsonFormat=='up'){$label=strtoupper($label);$message=strtoupper($message);}elseif($jsonFormat=='cap'){$label=ucwords($label);$message=ucwords($message);}elseif($jsonFormat=='capf'){$label=ucfirst($label);$message=ucfirst($message);}elseif($jsonFormat=='low-l'){$label=strtolower($label);}elseif($jsonFormat=='up-l'){$label=strtoupper($label);}elseif($jsonFormat=='cap-l'){$label=ucwords($label);}elseif($jsonFormat=='capf-l'){$label=ucfirst($label);}elseif($jsonFormat=='low-m'){$message=strtolower($message);}elseif($jsonFormat=='up-m'){$message=strtoupper($message);}elseif($jsonFormat=='cap-m'){$message=ucwords($message);}elseif($jsonFormat=='capf-m'){$message=ucfirst($message);}}$jsonColor=$json['color'];$jsonColor=strtolower($jsonColor);$messageColor=${'color_'.$jsonColor};if($messageColor==''){if(preg_match('/^[a-f 0-9]{6}$/i',$jsonColor)){$messageColor=$jsonColor;$messageColor='#'.$messageColor;}}}else{$label='Error';$message='Invalid JSON (No Data)';$messageColor='red';}}}}if(isset($_GET['label'])){$label=$_GET['label'];$label=htmlspecialchars($label);$defaultMessageIsSet=false;}if(isset($_GET['message'])){$message=$_GET['message'];$message=htmlspecialchars($message);$defaultMessageIsSet=false;}if(isset($_GET['icon'])){if(empty($_GET['icon'])){$icon='';}else{$icon=htmlspecialchars($_GET['icon']);$icon='&#x'.$_GET['icon'].';';if(mb_check_encoding($icon,'UTF-8')===false){$icon='&';}elseif(strlen($icon)!=8){$icon='&';}}}elseif($defaultMessageIsSet==false){$icon='';}if(isset($_GET['format'])){$imageFormat=$_GET['format'];$imageFormat=htmlspecialchars($imageFormat);$imageFormat=strtolower($imageFormat);if($imageFormat!='png'&&$imageFormat!='jpg'&&$imageFormat!='gif'){$imageFormat='png';}}if(isset($_GET['scale'])){$scale=$_GET['scale'];if(!is_numeric($scale)||$scale>$maxScale||$scale<0.1){$scale=20;}}if(isset($_GET['resizeoutput'])){if($_GET['resizeoutput']=='true'){$resizeOutput=true;}else{$resizeOutput=false;}}if(isset($_GET['cache'])){$cacheLife=$_GET['cache'];if(!is_numeric($cacheLife)){$cacheLife=5;}elseif($cacheLife>31536000){$cacheLife=31536000;}elseif($cacheLife<0){$cacheLife=1;}}if(isset($_GET['color'])&&$_GET['color']!=''){$_GET['color']=strtolower($_GET['color']);if(preg_match('/^[a-f 0-9]{6}$/i',$_GET['color'])){$messageColor=$_GET['color'];$messageColor='#'.$messageColor;}else{if(!isset(${'color_'.$_GET['color']})){$messageColor='#e05d44';}else{$messageColor=${'color_'.$_GET['color']};}}}if(isset($_GET['labelcolor'])&&$_GET['labelcolor']!=''){$_GET['labelcolor']=strtolower($_GET['labelcolor']);if(preg_match('/^[a-f 0-9]{6}$/i',$_GET['labelcolor'])){$labelColor=$_GET['labelcolor'];$labelColor='#'.$labelColor;}else{if(!isset(${'color_'.$_GET['labelcolor']})){$labelColor='#555555';}else{$labelColor=${'color_'.$_GET['labelcolor']};}}}if(isset($_GET['fontcolor'])&&$_GET['fontcolor']!=''){$_GET['fontcolor']=strtolower($_GET['fontcolor']);if(preg_match('/^[a-f 0-9]{6}$/i',$_GET['fontcolor'])){$colorText=$_GET['fontcolor'];$colorText='#'.$colorText;}else{if(!isset(${'color_'.$_GET['fontcolor']})){$colorText='#ffffff';}else{$colorText=${'color_'.$_GET['fontcolor']};}}}if(isset($_GET['autofontcolor'])&&$_GET['autofontcolor']=='false'){$autoFontColor=false;}elseif(isset($_GET['autofontcolor'])&&$_GET['autofontcolor']=='true'){$autoFontColor=true;}if(isset($icon)&&$icon!=''){$bbox=imagettfbbox((9*$scale),0,$font,$label);$labelWidth=$bbox[2]-$bbox[0];if(isset($_GET['scale'])){$bbox=imagettfbbox(15,0,$icons,$icon);}else{$bbox=imagettfbbox((1.06*$scale),0,$icons,$icon);}$iconWidth=$bbox[2]-$bbox[0];$labelWidth+=($iconWidth*$scale);$bbox=imagettfbbox((9*$scale),0,$font,$message);$messageWidth=$bbox[2]-$bbox[0];$imWidth=$labelWidth+$messageWidth+(15*$scale);$imHeight=(20*$scale);}else{$bbox=imagettfbbox((9*$scale),0,$font,$label);$labelWidth=$bbox[2]-$bbox[0];$labelWidth+=(5*$scale);$bbox=imagettfbbox((9*$scale),0,$font,$message);$messageWidth=$bbox[2]-$bbox[0];$imWidth=$labelWidth+$messageWidth+(15*$scale);$imHeight=(20*$scale);}$im=imagecreatetruecolor($imWidth,$imHeight);$labelColorackground=imagecolorallocate($im,255,255,255);$colorText=imagecolorallocate($im,hexdec(substr($colorText,1,2)),hexdec(substr($colorText,3,2)),hexdec(substr($colorText,5,2)));$messageColorHex=$messageColor;$messageColor=imagecolorallocate($im,hexdec(substr($messageColor,1,2)),hexdec(substr($messageColor,3,2)),hexdec(substr($messageColor,5,2)));$labelColorHex=$labelColor;$labelColor=imagecolorallocate($im,hexdec(substr($labelColor,1,2)),hexdec(substr($labelColor,3,2)),hexdec(substr($labelColor,5,2)));$labelColorText=$colorText;imagefilledrectangle($im,0,0,$imWidth,$imHeight,$messageColor);imagefilledrectangle($im,0,0,$labelWidth+(5*$scale),$imHeight,$labelColor);if(!isset($_GET['fontcolor'])&&$autoFontColor==true){$brightness=(hexdec(substr($labelColorHex,1,2))*0.299)+(hexdec(substr($labelColorHex,3,2))*0.587)+(hexdec(substr($labelColorHex,5,2))*0.114);if($brightness>165){$labelColorText=imagecolorallocate($im,0,0,0);}else{$labelColorText=imagecolorallocate($im,255,255,255);}}if(isset($icon)&&$icon!=''){$bbox=imagettfbbox((9*$scale),0,$icons,$icon);$textWidth=$bbox[2]-$bbox[0];imagettftext($im,(11*$scale),0,(5*$scale),(15*$scale),$labelColorText,$icons,$icon);$bbox=imagettfbbox((9*$scale),0,$font,$label);$textWidth=$bbox[2]-$bbox[0];imagettftext($im,(9*$scale),0,($iconWidth*$scale)+(1*$scale),(14*$scale),$labelColorText,$font,$label);}else{$bbox=imagettfbbox((9*$scale),0,$font,$label);$textWidth=$bbox[2]-$bbox[0];imagettftext($im,(9*$scale),0,(5*$scale),(14*$scale),$colorText,$font,$label);}if(!isset($_GET['fontcolor'])&&$autoFontColor==true){$brightness=(hexdec(substr($messageColorHex,1,2))*0.299)+(hexdec(substr($messageColorHex,3,2))*0.587)+(hexdec(substr($messageColorHex,5,2))*0.114);if($brightness>165){$colorText=imagecolorallocate($im,0,0,0);}else{$colorText=imagecolorallocate($im,255,255,255);}}$bbox=imagettfbbox((9*$scale),0,$font,$message);$textWidth=$bbox[2]-$bbox[0];imagettftext($im,(9*$scale),0,$labelWidth+(10*$scale),(14*$scale),$colorText,$font,$message);header('Cache-Control: max-age='.$cacheLife.', public');if($resizeOutput==true){$resizedImage=imagecreatetruecolor(($imWidth/$scale),($imHeight/$scale));imagecopyresampled($resizedImage,$im,0,0,0,0,($imWidth/$scale),($imHeight/$scale),$imWidth,$imHeight);$im=$resizedImage;}$imWidth=imagesx($im);$imHeight=imagesy($im);if($imWidth>1&&$imHeight>1){header('HTTP/1.1 200 OK');}else{header('HTTP/1.1 400 Bad Request');header('Content-Type: image/png');readfile('https://i.imgur.com/12cgeqB.png');exit;}header('Content-Disposition: inline; filename="'.$label.'-'.$message.'(PHP-Badges).'.$imageFormat.'"; alt="'.$label.' '.$message.'"');header('Content-Type: image/'.$imageFormat);imagepng($im);imagedestroy($im);if($checkForUpdates){$statisticsUrl='https://api.jm26.net/badge/statistics.php?exp='.md5('statistics'.date('h-i-d-m-Y')).'&v='.$Version;$checkForUpdates=file_get_contents($statisticsUrl);if($checkForUpdates!='success'&&file_exists('./PLEASE-UPDATE-PHP-BADGES.txt')==false){$file=fopen('./PLEASE-UPDATE-PHP-BADGES.txt','w');fwrite($file,'A new version is available. Please update PHP Badges to the latest version. \n You can download the latest version at https://github.com/JMcrafter26/php-badges/releases/latest \n  \n Happy coding! timestamp: '.time().' Current version: '.$Version.' Newest Version: '.$checkForUpdates);fclose($file);chmod('./PLEASE-UPDATE-PHP-BADGES.txt',770);}elseif(file_exists('./PLEASE-UPDATE-PHP-BADGES.txt')==true){unlink('./PLEASE-UPDATE-PHP-BADGES.txt');}}exit;